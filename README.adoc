:encoding: utf-8
:experimental:
:scripts: cjk
:icons: font
:stem: latexmath
:source-highlighter: pygments
:pygments-css: class
:pygments-style: material
:pygments-linenums-mode: inline
:sourcedir: src
:includedir: includes
:imagesdir: images
:title-logo-image: {imagesdir}/logo.png
:toc: left
:toc-title: 目录
:toclevels: 3
:sectnums:
:sectnumlevels: 3
:chapter-signifier!:
:sectanchors:
:idseparator: -
:figure-caption: 图
:table-caption: 表格
:author: Dandi Wong
:email: DandiToCoach@gmail.com
:pdf-theme: book_a4
:doctype: article
:revnumber: 1.0
:revdate: 2021-12-17 10:57:51
:revremark: Initial
= Vim Asciidoctor 改进

== 介绍

此插件是在 link:https://github.com/habamax/vim-asciidoctor[Vim-Asciidoctor] 项目基础上 fork 而来，原版介绍看 xref:README_Origin.adoc[]，本项目改进如下：

* [x] 新增 asciidoc 向 markdown 转换方法 `:Asciidoctor2MARKDOWN`。
* [x] 新增使用系统默认程序打开转换后的 markdown 方法 `:AsciidoctorOpenMARKDOWN`。
* [x] 新增 UltiSnips 格式的 snippets。
* [ ] 提供一套作者本人使用中的 asciidoctor-pdf 主题+字体，开箱即用。
* [ ] 给 pygments 搞一套 asciidoc 语法高亮的配置文件。

== 面向人群

* 日常工作有大量的文本编辑与格式化输出的需要，比如产品经理、文档整理员、博客与书籍作者等。
* 掌握 vim/neovim 和终端命令行的基本使用如进入退出 vim 和编辑文件、使用命令行复制粘贴 clone 代码库等基本操作即可。

== 安装基础依赖

* 安装 neovim 和 coc.nvim 的基础依赖

  $ brew install neovim node

* 安装 neovim 的 python3 支持

 $ python3 -m pip install neovim pynvim

* 安装 asciidoctor 与 pdf/docx 转换器、语法高亮依赖、neovim 支持

 $ gem install asciidoctor asciidoctor-pdf pygments.rb neovim

* 安装 coc.nvim

见 link:https://github.com/neoclide/coc.nvim/wiki/Install-coc.nvim[https://github.com/neoclide/coc.nvim/wiki/Install-coc.nvim]

* 安装本插件

 $ git clone https://github.com/DandiWong/vim-asciidoctor.git ~/.vim/bundle/vim-asciidoctor

== 必要的配置

=== neovim 配置

[source%linenums,vim]
.init.vim
----
let g:username = 'Dandi Wong'
let g:email = 'DandiToCoach@gmail.com'
let g:current_time = strftime('%Y-%m-%d %H:%M:%S', localtime())

let g:asciidoctor_executable = 'asciidoctor'
let g:asciidoctor_extensions = ['asciidoctor-diagram']
let g:asciidoctor_pdf_executable = 'asciidoctor-pdf'
let g:asciidoctor_pdf_extensions = ['asciidoctor-diagram']
" let g:asciidoctor_css_path = '~/docs/AsciiDocThemes'
let g:asciidoctor_pdf_themes_path = '~/.vim/bundle/vim-asciidoctor/themes'
let g:asciidoctor_pdf_fonts_path = '~/.vim/bundle/vim-asciidoctor/fonts'
let g:asciidoctor_pandoc_data_dir = '~/.vim/bundle/vim-asciidoctor/reference'
let g:asciidoctor_pandoc_executable = 'pandoc'
let g:asciidoctor_pandoc_other_params = '--toc --quiet'
let g:asciidoctor_fenced_languages = ['python', 'c', 'javascript', 'cpp', 'go', 'java', 'ruby', 'sh', 'typescript', 'markdown', 'html', 'css', 'rust', 'arduino', 'asciidoc']
let g:coc_global_extensions = ['coc-snippets']
----

=== coc.nvim 配置

安装 coc.nvim 后，启动 neovim 并在命令模式下 `:CocConfig` 打开配置文件，将下方配置项复制进去。

[source,json,linenums]
.coc-settings.json
----
{
  "snippets.ultisnips.enable": true,
  "snippets.priority": 90,
  "suggest.snippetsSupport": true,
  "snippets.enableStatusItem": true,
  "snippets.autoTrigger": true,
  "snippets.loadFromExtensions": true,
  "snippets.trace": "error",
  "snippets.ultisnips.directories": [
      "UltiSnips"
  ]
}
----

== 用起来吧！

=== 快速输入格式

`nvim test.adoc` 创建一个 asciidoc 文件进入编辑模式，输入 head 如果看到 snippet 提示就是可用了，通过 tab 键选择并回车即可，如下图:

image::snippets-header.png[]

== snippet 介绍

=== 标准文档头

作用见注释

[source%linenums,asciidoc]
.header
----
:encoding: utf-8 // 使用标准编码
:experimental:
:scripts: cjk // 支持中日韩文字与西文混排
:icons: font
:stem: latexmath
:source-highlighter: pygments
:pygments-css: class
:pygments-style: material // 高亮样式，可以去 gygments 官网看看其他喜欢的样式
:pygments-linenums-mode: inline // 文档中引用代码块时显示行号，但是浏览器预览时没展示，需要再调整
:sourcedir: src // 代码目录
:includedir:  // 引用文件目录
:imagesdir: images // 图片目录
:title-logo-image: logo.png
:toc: left  // 浏览器插件查看效果时目录在一旁
:toc-title: 目录
:toclevels: 3
:sectnums: // 启用章节编号
:sectnumlevels: 3
:chapter-signifier!: // 关闭章节自定义前缀
:sectanchors:
:idseparator: -
:figure-caption: 图 // 图片名称前缀
:table-caption: 表格 // 表格名称前缀
:author: `!v g:username` // 使用 init.vim 中自定义的作者名
:email: `!v g:email` // 同上
:pdf-theme: custom // 自定义主题
:doctype: book // book 比 article 多一些版式
:revnumber: 1.0
:revdate: `!v g:current_time` // 文档创建时间
:revremark: Initial
= ${1:`!v expand('%:r')`} // 使用去除路径和扩展的文件名作为标题
----

=== CSV 格式表格

这个版式比较符合平常写论文时候要求的版式:

.csv 表格展示
[frame=none,grid=rows,width="80%",role=center,cols="4*^",options="header,autowidth,unbreakable"]
,===
姓名,性别,年龄,电话
张三,男,38,13800000000
李四,男,38,13800000000
王五,男,38,13800000000
,===

asciidoc 格式为：

```asciidoc
.csv表格展示
[frame=none,grid=rows,width="80%",role=center,cols="4*^",options="header,autowidth,unbreakable"]
,===
姓名,性别,年龄,电话
张三,男,38,13800000000
李四,男,38,13800000000
王五,男,38,13800000000
,===
```

使用本人提供的 snippets 只需要输入


=== 复杂格式表格

.复杂表格
[frame=all,grid=all,width=100%,role=center,cols="3*^",options="header,autowidth,unbreakable"]
|===
^.^| C1 ^.^| C2 ^.^| C3 
<| C1R1 2+| C2R1
>m| C1R2 .2+^.^| C2R2 h| C3R2
s| C1R3 e| C3R3
|===

说起来搞笑，markdown 对于复杂表格的处理屎一样的表现促使我转向了 asciidoc，比如上面这种输出样式在 markdown （目前见到过的扩展）中是无法实现的，要是

```asciidoc
.复杂表格
[frame=all,grid=all,width=100%,role=center,cols="3*^",options="header,autowidth,unbreakable"]
|===
^.^| C1 ^.^| C2 ^.^| C3 
<| C1R1 2+| C2R1
>m| C1R2 .2+^.^| C2R2 h| C3R2
s| C1R3 e| C3R3
|===
```

== 多种格式输出

=== pdf 输出

=== workd 输出

=== markdown 输出

=== 浏览器预览及 html 输出

<<<
== LICENSE

include::LICENSE[leveloffset=+1]
